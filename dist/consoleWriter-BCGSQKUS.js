var Qe=Object.defineProperty;var l=(t,e)=>Qe(t,"name",{value:e,configurable:!0});import Ve from"@anthropic-ai/sdk";import*as w from"zod";import W,{z as G}from"zod";import{FinishReason as v,GoogleGenAI as et}from"@google/genai";import tt from"openai";import{serializeError as nt}from"serialize-error";import{readFile as st,access as rt,constants as ot}from"fs/promises";import{glob as ue}from"glob";import{readFile as H,access as le,stat as it,writeFile as at,mkdir as ct}from"node:fs/promises";import{resolve as te,extname as fe,dirname as ut}from"node:path";import{exec as lt}from"node:child_process";import{promisify as ft}from"node:util";import T from"chalk";import pe from"node:readline";class S extends Error{static{l(this,"AxleError")}code;id;details;constructor(e,n){super(e,{cause:n?.cause}),this.name=this.constructor.name,this.code=n?.code||"AXLE_ERROR",this.id=n?.id,this.details=n?.details,Object.setPrototypeOf(this,S.prototype)}}function pt(t){const{text:e,files:n}=t,s=[];if(e&&s.push({type:"text",text:e}),n)for(const r of n)s.push({type:"file",file:r});return s}l(pt,"toContentParts");function C(t){return typeof t=="string"?t:t.filter(e=>e.type==="text").map(e=>e.text).join(`

`)}l(C,"getTextContent");function dt(t){return t.filter(e=>e.type==="tool-call")}l(dt,"getToolCalls");var E=(t=>(t[t.Stop=0]="Stop",t[t.Length=1]="Length",t[t.FunctionCall=2]="FunctionCall",t[t.Error=3]="Error",t[t.Custom=4]="Custom",t))(E||{});function B(t){if(t==null)return{type:"error",error:{type:"Undetermined",message:"Unknown error occurred"},usage:{in:0,out:0},raw:t};if(t instanceof Error)return{type:"error",error:{type:t.name||"Error",message:t.message||"Unexpected error"},usage:{in:0,out:0},raw:t};if(typeof t=="object"){const e=t,n=e?.error?.error?.type||e?.error?.type||e?.type||e?.code||e?.status||"Undetermined",s=e?.error?.error?.message||e?.error?.message||e?.message||e?.error||"Unexpected error";return{type:"error",error:{type:String(n),message:String(s)},usage:{in:0,out:0},raw:t}}return{type:"error",error:{type:"Undetermined",message:String(t)},usage:{in:0,out:0},raw:t}}l(B,"getUndefinedError");function de(t){return t.map(e=>{if(e.role==="assistant"){const n=[];for(const s of e.content)s.type==="text"?n.push({type:"text",text:s.text}):s.type==="thinking"?s.redacted?n.push({type:"redacted_thinking",data:s.text}):n.push({type:"thinking",thinking:s.text,signature:s.signature}):s.type==="tool-call"&&n.push({type:"tool_use",id:s.id,name:s.name,input:s.parameters});return{role:"assistant",content:n}}if(e.role==="tool")return{role:"user",content:e.content.map(n=>({type:"tool_result",tool_use_id:n.id,content:n.content}))};if(typeof e.content=="string")return{role:"user",content:e.content};{const n=[];for(const s of e.content)s.type==="text"?n.push({type:"text",text:s.text}):s.type==="file"&&(s.file.type==="image"?n.push({type:"image",source:{type:"base64",media_type:s.file.mimeType,data:s.file.base64}}):s.file.type==="document"&&s.file.mimeType==="application/pdf"&&n.push({type:"document",source:{type:"base64",media_type:"application/pdf",data:s.file.base64}}));return{role:"user",content:n}}})}l(de,"convertToProviderMessages");function _e(t){return t.map(e=>{const n=W.toJSONSchema(e.schema);if(!_t(n))throw new Error(`Schema for tool ${e.name} must be an object type`);return{name:e.name,description:e.description,input_schema:n}})}l(_e,"convertToProviderTools");function me(t){const e=[];for(const n of t)if(n.type==="text")e.push({type:"text",text:n.text});else if(n.type==="thinking")e.push({type:"thinking",text:n.text||"",redacted:!1});else if(n.type==="redacted_thinking")e.push({type:"thinking",text:n.text||"",redacted:!0});else if(n.type==="tool_use"){if(typeof n.input!="object"||n.input===null||Array.isArray(n.input))throw new Error(`Invalid tool call input for ${n.name}: expected object, got ${typeof n.input}`);e.push({type:"tool-call",id:n.id,name:n.name,parameters:n.input})}return e}l(me,"convertToAxleContentParts");function ne(t){switch(t){case"max_tokens":return E.Length;case"end_turn":return E.Stop;case"stop_sequence":return E.Stop;case"tool_use":return E.FunctionCall;case"pause_turn":case"refusal":default:return E.Error}}l(ne,"convertStopReason$2");function _t(t){return t&&typeof t=="object"&&t.type==="object"}l(_t,"isObjectSchema");async function mt(t){const{client:e,model:n,messages:s,system:r,tools:o,context:i,options:u}=t,{recorder:a}=i,c=u?{...u}:{};c.stop&&(c.stop_sequences=Array.isArray(c.stop)?c.stop:[c.stop],delete c.stop);const f={model:n,max_tokens:4096,messages:de(s),...r&&{system:r},...o&&{tools:_e(o)},...c};a?.debug?.log(f);let d;try{const p=await e.messages.create(f);d=gt(p)}catch(p){d=B(p)}return a?.debug?.log(d),d}l(mt,"createGenerationRequest$2");function gt(t){const e=ne(t.stop_reason);if(e===E.Error)return{type:"error",error:{type:"Uncaught error",message:`Stop reason is not recognized or unhandled: ${t.stop_reason}`},usage:{in:t.usage.input_tokens,out:t.usage.output_tokens},raw:t};if(e===E.FunctionCall){const n=me(t.content);return{type:"success",id:t.id,model:t.model,role:t.role,finishReason:E.FunctionCall,content:n,text:C(n)??"",usage:{in:t.usage.input_tokens,out:t.usage.output_tokens},raw:t}}if(t.type=="message"){const n=me(t.content);return{type:"success",id:t.id,model:t.model,role:"assistant",finishReason:e,content:n,text:C(n)??"",usage:{in:t.usage.input_tokens,out:t.usage.output_tokens},raw:t}}}l(gt,"convertToAIResponse");function ht(){const t=new Map;function e(n){const s=[];switch(n.type){case"message_start":s.push({type:"start",id:n.message.id,data:{model:n.message.model,timestamp:Date.now()}});break;case"message_delta":n.delta.stop_reason&&s.push({type:"complete",data:{finishReason:ne(n.delta.stop_reason),usage:n.usage?{in:n.usage.input_tokens||0,out:n.usage.output_tokens||0}:void 0}});case"message_stop":break;case"content_block_start":if(n.content_block.type==="text")n.index;else if(n.content_block.type==="tool_use"){const o=n.content_block;t.set(n.index,{id:o.id,name:o.name,argumentsBuffer:""}),s.push({type:"tool-call-start",data:{index:n.index,id:o.id,name:o.name}})}else n.content_block.type==="thinking"?s.push({type:"thinking-start",data:{index:n.index,redacted:!1}}):n.content_block.type==="redacted_thinking"?s.push({type:"thinking-start",data:{index:n.index,redacted:!0}}):n.content_block.type==="server_tool_use"||n.content_block.type;break;case"content_block_delta":if(n.delta.type==="text_delta")s.push({type:"text",data:{text:n.delta.text,index:n.index}});else if(n.delta.type==="input_json_delta"){const o=t.get(n.index);o&&(o.argumentsBuffer+=n.delta.partial_json)}else n.delta.type==="thinking_delta"?s.push({type:"thinking-delta",data:{text:n.delta.thinking,index:n.index}}):n.delta.type==="signature_delta"||n.delta.type;break;case"content_block_stop":const r=t.get(n.index);if(r){try{const o=JSON.parse(r.argumentsBuffer);s.push({type:"tool-call-complete",data:{index:n.index,id:r.id,name:r.name,arguments:o}})}catch(o){throw new Error(`Failed to parse tool call arguments for ${r.name}: ${o instanceof Error?o.message:String(o)}`)}t.delete(n.index)}break;default:console.warn("Unknown Anthropic stream event type")}return s}return l(e,"handleEvent"),{handleEvent:e}}l(ht,"createAnthropicStreamingAdapter");async function*yt(t){const{client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}=t,{recorder:a}=i,c=u?{...u}:{};c.stop&&(c.stop_sequences=Array.isArray(c.stop)?c.stop:[c.stop],delete c.stop);const f={model:n,max_tokens:4096,messages:de(s),...r&&{system:r},...o&&{tools:_e(o)},...c};a?.debug?.log(f);const d=ht();try{const p=await e.messages.create({...f,stream:!0});for await(const _ of p){const h=d.handleEvent(_);for(const g of h)yield g}}catch(p){yield{type:"error",data:{type:"STREAMING_ERROR",message:p instanceof Error?p.message:String(p),raw:p}}}}l(yt,"createStreamingRequest$3");const R={CLAUDE_SONNET_4_5_20250929:"claude-sonnet-4-5-20250929",CLAUDE_SONNET_4_5_LATEST:"claude-sonnet-4-5",CLAUDE_HAIKU_4_5:"claude-haiku-4-5",CLAUDE_OPUS_4_1_20250805:"claude-opus-4-1-20250805",CLAUDE_OPUS_4_1_LATEST:"claude-opus-4-1",CLAUDE_OPUS_4_20250514:"claude-opus-4-20250514",CLAUDE_OPUS_4_LATEST:"claude-opus-4-0",CLAUDE_SONNET_4_20250514:"claude-sonnet-4-20250514",CLAUDE_SONNET_4_LATEST:"claude-sonnet-4-0",CLAUDE_3_7_SONNET_20250219:"claude-3-7-sonnet-20250219",CLAUDE_3_7_SONNET_LATEST:"claude-3-7-sonnet-latest",CLAUDE_3_5_SONNET_20241022:"claude-3-5-sonnet-20241022",CLAUDE_3_5_HAIKU_20241022:"claude-3-5-haiku-20241022",CLAUDE_3_5_HAIKU_LATEST:"claude-3-5-haiku-latest",CLAUDE_3_5_SONNET_20240620:"claude-3-5-sonnet-20240620"};R.CLAUDE_SONNET_4_5_20250929,R.CLAUDE_SONNET_4_5_LATEST,R.CLAUDE_HAIKU_4_5,R.CLAUDE_OPUS_4_1_20250805,R.CLAUDE_OPUS_4_1_LATEST,R.CLAUDE_OPUS_4_20250514,R.CLAUDE_OPUS_4_LATEST,R.CLAUDE_SONNET_4_20250514,R.CLAUDE_SONNET_4_LATEST,R.CLAUDE_3_7_SONNET_20250219,R.CLAUDE_3_7_SONNET_LATEST,R.CLAUDE_3_5_SONNET_20241022,R.CLAUDE_3_5_HAIKU_20241022,R.CLAUDE_3_5_HAIKU_LATEST,R.CLAUDE_3_5_SONNET_20240620;const ge=R.CLAUDE_HAIKU_4_5,he="anthorpic";class Et{static{l(this,"AnthropicProvider")}name=he;client;model;constructor(e,n){this.model=n??ge,this.client=new Ve({apiKey:e})}async createGenerationRequest(e){return await mt({client:this.client,model:this.model,...e})}createStreamingRequest(e){const{messages:n,system:s,tools:r,context:o,options:i}=e;return yt({client:this.client,model:this.model,messages:n,system:s,tools:r,runtime:o,options:i})}}function ye(t,e,n){const s={};return e&&(s.systemInstruction=e),t&&t.length>0&&(s.tools=t.map(r=>({functionDeclarations:[{name:r.name,description:r.description,parametersJsonSchema:W.toJSONSchema(r.schema)}]}))),n&&Object.assign(s,n),s}l(ye,"prepareConfig");function Ee(t){return t.map(It).filter(e=>e!==void 0)}l(Ee,"convertAxleMessagesToGemini");function It(t){switch(t.role){case"tool":return wt(t);case"assistant":return Tt(t);case"user":return xt(t)}}l(It,"convertMessage$3");function wt(t){return{role:"user",parts:t.content.map(e=>({functionResponse:{id:e.id??void 0,name:e.name,response:{output:e.content}}}))}}l(wt,"convertToolMessage$3");function Tt(t){const e=[],n=t.content.filter(r=>r.type==="text");if(n.length>0){const r=n.map(o=>o.text).join("");r&&e.push({text:r})}const s=t.content.filter(r=>r.type==="tool-call");return s.length>0&&e.push(...s.map(r=>({functionCall:{id:r.id??void 0,name:r.name,args:r.parameters}}))),{role:"assistant",parts:e}}l(Tt,"convertAssistantMessage$3");function xt(t){return typeof t.content=="string"?{role:"user",parts:[{text:t.content}]}:{role:"user",parts:t.content.map(At).filter(n=>n!==null)}}l(xt,"convertUserMessage$3");function At(t){return t.type==="text"||t.type==="instructions"?{text:t.type==="text"?t.text:t.instructions}:t.type==="file"&&(t.file.type==="image"||t.file.type==="document")?{inlineData:{mimeType:t.file.mimeType,data:t.file.base64}}:null}l(At,"convertContentPart$3");function Ie(t){switch(t){case v.STOP:return[!0,E.Stop];case v.MAX_TOKENS:return[!0,E.Length];case v.FINISH_REASON_UNSPECIFIED:case v.SAFETY:case v.RECITATION:case v.LANGUAGE:case v.OTHER:case v.BLOCKLIST:case v.PROHIBITED_CONTENT:case v.SPII:case v.MALFORMED_FUNCTION_CALL:case v.IMAGE_SAFETY:return[!1,E.Error]}}l(Ie,"convertStopReason$1");async function St(t){const{client:e,model:n,messages:s,system:r,tools:o,context:i,options:u}=t,{recorder:a}=i,c=u?{...u}:{};c.max_tokens&&(c.maxOutputTokens=c.max_tokens,delete c.max_tokens),c.stop&&(c.stopSequences=Array.isArray(c.stop)?c.stop:[c.stop],delete c.stop),c.top_p!==void 0&&(c.topP=c.top_p,delete c.top_p);const f={contents:Ee(s),config:ye(o,r,c)};a?.debug?.log(f);let d;try{const p=await e.models.generateContent({model:n,...f});d=kt(p,{recorder:a})}catch(p){a?.error?.log(p),d=B(p)}return a?.debug?.log(d),d}l(St,"createGenerationRequest$1");function kt(t,e){const{recorder:n}=e,s=t.usageMetadata.promptTokenCount,r=t.usageMetadata.totalTokenCount-s,o={in:s,out:r};if(!t)return{type:"error",error:{type:"InvalidResponse",message:"Invalid or empty response from Google AI"},usage:{in:0,out:0},raw:t};if(t.promptFeedback&&t.promptFeedback.blockReason)return{type:"error",error:{type:"Blocked",message:`Response blocked by Google AI: ${t.promptFeedback.blockReason}, ${t.promptFeedback.blockReasonMessage}`},usage:o,raw:t};if(!t.candidates||t.candidates.length===0)return{type:"error",error:{type:"InvalidResponse",message:"Invalid or empty response from Google AI"},usage:{in:0,out:0},raw:t};t.candidates.length>1&&n?.warn?.log(`We received ${t.candidates.length} response candidates`);const i=t.candidates[0],a=(i.content?.parts||[]).map(d=>d.text).filter(d=>d!==void 0).join(""),[c,f]=Ie(i.finishReason);if(c){const d=[];if(a&&d.push({type:"text",text:a}),t.functionCalls)for(const p of t.functionCalls){if(typeof p.args!="object"||p.args===null||Array.isArray(p.args))throw new Error(`Invalid tool call arguments for ${p.name}: expected object, got ${typeof p.args}`);d.push({type:"tool-call",id:p.id,name:p.name,parameters:p.args})}return{type:"success",id:t.responseId,model:t.modelVersion,role:"assistant",finishReason:t.functionCalls?E.FunctionCall:f,content:d,text:C(d)??"",usage:o,raw:t}}else return{type:"error",error:{type:"Undetermined",message:`Unexpected stop reason: ${f}`},usage:o,raw:t}}l(kt,"fromModelResponse$3");function bt(){let t=0,e=-1,n="",s="",r=0,o=0;function i(u){const a=[];n||(n=u.responseId||`gemini-${Date.now()}`,s=u.modelVersion||"gemini",a.push({type:"start",id:n,data:{model:s,timestamp:Date.now()}})),u.usageMetadata&&(r=u.usageMetadata.promptTokenCount||0,o=(u.usageMetadata.totalTokenCount||0)-r);const c=u.candidates?.[0];if(!c)return a;const f=c.content?.parts||[];for(const d of f){const p="thought"in d&&d.thought===!0;if(p&&d.text?(e===-1&&(e=t+1,a.push({type:"thinking-start",data:{index:e}})),a.push({type:"thinking-delta",data:{index:e,text:d.text}})):d.text&&!p&&a.push({type:"text",data:{text:d.text,index:t}}),d.functionCall){t++;const _=`tool-${t}`;a.push({type:"tool-call-start",data:{index:t,id:_,name:d.functionCall.name}}),a.push({type:"tool-call-complete",data:{index:t,id:_,name:d.functionCall.name,arguments:d.functionCall.args}})}}if(c.finishReason){const[d,p]=Ie(c.finishReason);d?a.push({type:"complete",data:{finishReason:p,usage:{in:r,out:o}}}):a.push({type:"error",data:{type:"FinishReasonError",message:`Unexpected finish reason: ${c.finishReason}`,usage:{in:r,out:o},raw:u}})}return a}return l(i,"handleChunk"),{handleChunk:i}}l(bt,"createGeminiStreamingAdapter");async function*Rt(t){const{client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}=t,{recorder:a}=i,c=u?{...u}:{};c.max_tokens&&(c.maxOutputTokens=c.max_tokens,delete c.max_tokens),c.stop&&(c.stopSequences=Array.isArray(c.stop)?c.stop:[c.stop],delete c.stop),c.top_p!==void 0&&(c.topP=c.top_p,delete c.top_p);const f={contents:Ee(s),config:ye(o,r,c)};a?.debug?.log(f);const d=bt();try{const p=await e.models.generateContentStream({model:n,...f});for await(const _ of p){const h=d.handleChunk(_);for(const g of h)yield g}}catch(p){a?.error?.log(p),yield{type:"error",data:{type:"STREAMING_ERROR",message:p instanceof Error?p.message:String(p),raw:p}}}}l(Rt,"createStreamingRequest$2");const y={GEMINI_2_5_PRO:"gemini-2.5-pro",GEMINI_2_5_FLASH:"gemini-2.5-flash",GEMINI_2_5_FLASH_PREVIEW_05_20:"gemini-2.5-flash-preview-05-20",GEMINI_2_5_FLASH_LITE:"gemini-2.5-flash-lite",GEMINI_2_5_FLASH_LITE_PREVIEW_06_17:"gemini-2.5-flash-lite-preview-06-17",GEMINI_2_5_FLASH_LIVE_PREVIEW:"gemini-live-2.5-flash-preview",GEMINI_2_5_FLASH_PREVIEW_NATIVE_AUDIO_DIALOG:"gemini-2.5-flash-preview-native-audio-dialog",GEMINI_2_5_FLASH_EXP_NATIVE_AUDIO_THINKING_DIALOG:"gemini-2.5-flash-exp-native-audio-thinking-dialog",GEMINI_2_5_FLASH_IMAGE_PREVIEW:"gemini-2.5-flash-image-preview",GEMINI_2_5_FLASH_PREVIEW_TTS:"gemini-2.5-flash-preview-tts",GEMINI_2_5_PRO_PREVIEW_TTS:"gemini-2.5-pro-preview-tts",GEMINI_2_0_FLASH:"gemini-2.0-flash",GEMINI_2_0_FLASH_001:"gemini-2.0-flash-001",GEMINI_2_0_FLASH_EXP:"gemini-2.0-flash-exp",GEMINI_2_0_FLASH_PREVIEW_IMAGE_GENERATION:"gemini-2.0-flash-preview-image-generation",GEMINI_2_0_FLASH_LITE:"gemini-2.0-flash-lite",GEMINI_2_0_FLASH_LITE_001:"gemini-2.0-flash-lite-001",GEMINI_2_0_FLASH_LIVE_001:"gemini-2.0-flash-live-001",GEMINI_1_5_PRO:"gemini-1.5-pro",GEMINI_1_5_PRO_LATEST:"gemini-1.5-pro-latest",GEMINI_1_5_PRO_001:"gemini-1.5-pro-001",GEMINI_1_5_PRO_002:"gemini-1.5-pro-002",GEMINI_1_5_FLASH:"gemini-1.5-flash",GEMINI_1_5_FLASH_LATEST:"gemini-1.5-flash-latest",GEMINI_1_5_FLASH_001:"gemini-1.5-flash-001",GEMINI_1_5_FLASH_002:"gemini-1.5-flash-002",GEMINI_1_5_FLASH_8B:"gemini-1.5-flash-8b",GEMINI_1_5_FLASH_8B_LATEST:"gemini-1.5-flash-8b-latest",GEMINI_1_5_FLASH_8B_001:"gemini-1.5-flash-8b-001",GEMMA_3N_E4B_IT:"gemma-3n-e4b-it",GEMMA_3_1B_IT:"gemma-3-1b-it",GEMMA_3_4B_IT:"gemma-3-4b-it",GEMMA_3_12B_IT:"gemma-3-12b-it",GEMMA_3_27B_IT:"gemma-3-27b-it",LEARNLM_2_0_FLASH_EXPERIMENTAL:"learnlm-2.0-flash-experimental",EMBEDDING_001:"embedding-001",TEXT_EMBEDDING_004:"text-embedding-004"};y.GEMINI_2_5_PRO,y.GEMINI_2_5_FLASH,y.GEMINI_2_5_FLASH_PREVIEW_05_20,y.GEMINI_2_5_FLASH_LITE,y.GEMINI_2_5_FLASH_LITE_PREVIEW_06_17,y.GEMINI_2_5_FLASH_LIVE_PREVIEW,y.GEMINI_2_5_FLASH_PREVIEW_NATIVE_AUDIO_DIALOG,y.GEMINI_2_5_FLASH_EXP_NATIVE_AUDIO_THINKING_DIALOG,y.GEMINI_2_5_FLASH_IMAGE_PREVIEW,y.GEMINI_2_0_FLASH,y.GEMINI_2_0_FLASH_001,y.GEMINI_2_0_FLASH_EXP,y.GEMINI_2_0_FLASH_PREVIEW_IMAGE_GENERATION,y.GEMINI_2_0_FLASH_LITE,y.GEMINI_2_0_FLASH_LITE_001,y.GEMINI_2_0_FLASH_LIVE_001,y.GEMINI_1_5_PRO,y.GEMINI_1_5_PRO_LATEST,y.GEMINI_1_5_PRO_001,y.GEMINI_1_5_PRO_002,y.GEMINI_1_5_FLASH,y.GEMINI_1_5_FLASH_LATEST,y.GEMINI_1_5_FLASH_001,y.GEMINI_1_5_FLASH_002,y.GEMINI_1_5_FLASH_8B,y.GEMINI_1_5_FLASH_8B_LATEST,y.GEMINI_1_5_FLASH_8B_001,y.GEMMA_3N_E4B_IT,y.GEMMA_3_1B_IT,y.GEMMA_3_4B_IT,y.GEMMA_3_12B_IT,y.GEMMA_3_27B_IT,y.LEARNLM_2_0_FLASH_EXPERIMENTAL;const we=y.GEMINI_2_5_FLASH,Te="Gemini";class Pt{static{l(this,"GeminiProvider")}name=Te;client;model;constructor(e,n){this.model=n??we,this.client=new et({apiKey:e})}async createGenerationRequest(e){return await St({client:this.client,model:this.model,...e})}createStreamingRequest(e){const{messages:n,system:s,tools:r,context:o,options:i}=e;return Rt({client:this.client,model:this.model,messages:n,system:s,tools:r,runtime:o,options:i})}}function xe(t){return t.map(Ot).flat(1)}l(xe,"convertAxleMessagesToOllama");function Ae(t){return t&&t.length>0?t.map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:W.toJSONSchema(e.schema)}})):void 0}l(Ae,"convertToolDefToOllama");function Ot(t){switch(t.role){case"tool":return vt(t);case"assistant":return Nt(t);default:return $t(t)}}l(Ot,"convertMessage$2");function vt(t){return t.content.map(e=>({role:"tool",tool_call_id:e.id,content:e.content}))}l(vt,"convertToolMessage$2");function Nt(t){const e=t.content.filter(r=>r.type==="tool-call"),n=t.content.filter(r=>r.type==="text"),s=e.length>0?e.map(r=>({type:"function",id:r.id,function:{name:r.name,arguments:r.parameters}})):void 0;return{role:t.role,content:n.map(r=>r.text).join(""),...s&&{toolCalls:s}}}l(Nt,"convertAssistantMessage$2");function $t(t){if(typeof t.content=="string")return{role:t.role,content:t.content};{const e=[],n=[];for(const s of t.content){const r=Mt(s);r.text!==null&&e.push(r.text),r.image!==null&&n.push(r.image)}return{role:t.role,content:e.join(""),...n.length>0&&{images:n}}}}l($t,"convertUserMessage$2");function Mt(t){return t.type==="text"||t.type==="instructions"?{text:t.type==="text"?t.text:t.instructions,image:null}:t.type==="file"&&t.file.type==="image"?{text:null,image:t.file.base64}:{text:null,image:null}}l(Mt,"convertContentPart$2");async function Gt(t){const{url:e,model:n,messages:s,system:r,tools:o,context:i,options:u}=t,{recorder:a}=i,c=Ae(o),f=u?{...u}:{temperature:.7};f.max_tokens&&(f.num_predict=f.max_tokens,delete f.max_tokens);const d={model:n,messages:xe(s),stream:!1,options:f,...r&&{system:r},...c&&{tools:c}};a?.debug?.log(d);let p;try{const _=await fetch(`${e}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const h=await _.json();p=Ct(h)}catch(_){a?.error?.log("Error fetching Ollama response:",_),p=B(_)}return a?.debug?.log(p),p}l(Gt,"createGenerationRequest");function Ct(t){if(t.done_reason==="stop"&&t.message){const e=[];if(t.message.content!==void 0&&e.push({type:"text",text:t.message.content}),t.message.tool_calls)for(const s of t.message.tool_calls){if(typeof s.function.arguments!="object"||s.function.arguments===null||Array.isArray(s.function.arguments))throw new Error(`Invalid tool call arguments for ${s.function.name}: expected object, got ${typeof s.function.arguments}`);e.push({type:"tool-call",id:s.id,name:s.function.name,parameters:s.function.arguments})}const n=e.some(s=>s.type==="tool-call");return{type:"success",id:`ollama-${Date.now()}`,model:t.model,role:"assistant",finishReason:n?E.FunctionCall:E.Stop,content:e,text:C(e)??"",usage:{in:t.prompt_eval_count||0,out:t.eval_count||0},raw:t}}return{type:"error",error:{type:"OllamaError",message:"Unexpected error from Ollama"},usage:{in:0,out:0},raw:t}}l(Ct,"fromModelResponse$2");function Lt(){let t="",e=0,n=-1,s=0;function r(o){const i=[];if(t||(t=`ollama-${Date.now()}`,i.push({type:"start",id:t,data:{model:o.model,timestamp:Date.now()}})),o.message?.thinking&&(n===-1&&(n=e+1,i.push({type:"thinking-start",data:{index:n}})),i.push({type:"thinking-delta",data:{index:n,text:o.message.thinking}})),o.message?.content&&i.push({type:"text",data:{text:o.message.content,index:e}}),o.message?.tool_calls)for(const u of o.message.tool_calls){s++;const a=u.id||`tool-${s}`;if(typeof u.function.arguments!="object"||u.function.arguments===null||Array.isArray(u.function.arguments))throw new Error(`Invalid tool call arguments for ${u.function.name}: expected object, got ${typeof u.function.arguments}`);i.push({type:"tool-call-start",data:{index:s,id:a,name:u.function.name}}),i.push({type:"tool-call-complete",data:{index:s,id:a,name:u.function.name,arguments:u.function.arguments}})}if(o.done){const u=Dt(o.done_reason);i.push({type:"complete",data:{finishReason:u,usage:{in:o.prompt_eval_count||0,out:o.eval_count||0}}})}return i}return l(r,"handleChunk"),{handleChunk:r}}l(Lt,"createOllamaStreamingAdapter");function Dt(t){switch(t){case"stop":return E.Stop;case"length":return E.Length;default:return E.Stop}}l(Dt,"convertStopReason");async function*Ft(t){const{url:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}=t,{recorder:a}=i,c=Ae(o),f=u?{...u}:{temperature:.7};f.max_tokens&&(f.num_predict=f.max_tokens,delete f.max_tokens);const d={model:n,messages:xe(s),stream:!0,options:f,...r&&{system:r},...c&&{tools:c}};a?.debug?.log(d);const p=Lt();try{const _=await fetch(`${e}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);if(!_.body)throw new Error("Response body is null");const h=_.body.getReader(),g=new TextDecoder;let A="";for(;;){const{done:k,value:b}=await h.read();if(k)break;A+=g.decode(b,{stream:!0});const O=A.split(`
`);A=O.pop()||"";for(const $ of O)if($.trim())try{const P=JSON.parse($),L=p.handleChunk(P);for(const M of L)yield M}catch(P){a?.error?.log("Error parsing Ollama stream chunk:",P,$)}}}catch(_){a?.error?.log("Error in Ollama streaming request:",_),yield{type:"error",data:{type:"STREAMING_ERROR",message:_ instanceof Error?_.message:String(_),raw:_}}}}l(Ft,"createStreamingRequest$1");const Se="http://localhost:11434",Ut="Ollama";class Wt{static{l(this,"OllamaProvider")}name="Ollama";url;model;recorder;constructor(e,n){this.url=n||Se,this.model=e}async createGenerationRequest(e){return await Gt({url:this.url,model:this.model,...e})}createStreamingRequest(e){const{messages:n,system:s,tools:r,context:o,options:i}=e;return Ft({url:this.url,model:this.model,messages:n,system:s,tools:r,runtime:o,options:i})}}function ke(t){if(t&&t.length>0)return t.map(e=>{const n=W.toJSONSchema(e.schema);return{type:"function",function:{name:e.name,description:e.description,parameters:n}}})}l(ke,"toModelTools");function be(t,e){const n=t.map(Ht).flat(1);return e?[{role:"system",content:e},...n]:n}l(be,"convertAxleMessagesToChatCompletion");function Ht(t){switch(t.role){case"tool":return Bt(t);case"assistant":return qt(t);default:return Jt(t)}}l(Ht,"convertMessage$1");function Bt(t){return t.content.map(e=>({role:"tool",tool_call_id:e.id,content:e.content}))}l(Bt,"convertToolMessage$1");function qt(t){const e=t.content.filter(r=>r.type==="tool-call"),n=t.content.filter(r=>r.type==="text"),s=e.length>0?e.map(r=>({type:"function",id:r.id,function:{name:r.name,arguments:JSON.stringify(r.parameters)}})):void 0;return{role:t.role,content:n.map(r=>r.text).join(""),...s&&{tool_calls:s}}}l(qt,"convertAssistantMessage$1");function Jt(t){if(typeof t.content=="string")return{role:t.role,content:t.content};{const e=t.content.map(jt).filter(n=>n!==null);return{role:t.role,content:e}}}l(Jt,"convertUserMessage$1");function jt(t){if(t.type==="text"||t.type==="instructions")return{type:"text",text:t.type==="text"?t.text:t.instructions};if(t.type==="file"){if(t.file.type==="image")return{type:"image_url",image_url:{url:`data:${t.file.mimeType};base64,${t.file.base64}`}};if(t.file.type==="document")return{type:"file",file:{filename:t.file.name,file_data:`data:${t.file.mimeType};base64,${t.file.base64}`}}}return null}l(jt,"convertContentPart$1");async function Kt(t){const{client:e,model:n,messages:s,system:r,tools:o,context:i,options:u}=t,{recorder:a}=i;let c=ke(o);const f={model:n,messages:be(s,r),...c&&{tools:c},...u};a?.debug?.log(f);let d;try{const p=await e.chat.completions.create(f);d=zt(p)}catch(p){a?.error?.log(p),d=B(p)}return a?.debug?.log(d),d}l(Kt,"createGenerationRequestWithChatCompletion");function zt(t){if(t.choices.length>0){const e=t.choices[0],n=[];if(e.message.content&&n.push({type:"text",text:e.message.content}),e.message.tool_calls){for(const s of e.message.tool_calls)if(s.type==="function")try{n.push({type:"tool-call",id:s.id,name:s.function.name,parameters:JSON.parse(s.function.arguments)})}catch(r){throw new Error(`Failed to parse tool call arguments for ${s.function.name}: ${r instanceof Error?r.message:String(r)}`)}}return{type:"success",id:t.id,model:t.model,role:e.message.role,finishReason:ne(e.finish_reason),content:n,text:C(n)??"",usage:{in:t.usage?.prompt_tokens??0,out:t.usage?.completion_tokens??0},raw:t}}return{type:"error",error:{type:"undetermined",message:"Unexpected response from OpenAI"},usage:{in:t.usage?.prompt_tokens??0,out:t.usage?.completion_tokens??0},raw:t}}l(zt,"fromModelResponse$1");function Xt(){const t=new Map;let e=0,n="",s="";function r(o){const i=[],u=o.choices[0];if(!u)return i;n||(n=o.id,s=o.model,i.push({type:"start",id:n,data:{model:s,timestamp:Date.now()}}));const a=u.delta;if(a.content&&i.push({type:"text",data:{text:a.content,index:e}}),a.tool_calls)for(const c of a.tool_calls){const f=c.index;if(!t.has(f)){const p=e+f+1,_=c.id||`tool-${p}`;t.set(f,{id:_,name:c.function?.name||"",argumentsBuffer:""}),i.push({type:"tool-call-start",data:{index:p,id:_,name:c.function?.name||""}})}const d=t.get(f);c.id&&(d.id=c.id),c.function?.name&&(d.name=c.function.name),c.function?.arguments&&(d.argumentsBuffer+=c.function.arguments)}if(u.finish_reason){for(const[f,d]of t){const p=e+f+1;try{const _=JSON.parse(d.argumentsBuffer);i.push({type:"tool-call-complete",data:{index:p,id:d.id,name:d.name,arguments:_}})}catch(_){throw new Error(`Failed to parse tool call arguments for ${d.name}: ${_ instanceof Error?_.message:String(_)}`)}}const c=Zt(u.finish_reason);i.push({type:"complete",data:{finishReason:c,usage:o.usage?{in:o.usage.prompt_tokens,out:o.usage.completion_tokens}:{in:0,out:0}}})}return i}return l(r,"handleChunk"),{handleChunk:r}}l(Xt,"createChatCompletionStreamingAdapter");function Zt(t){switch(t){case"stop":return E.Stop;case"length":return E.Length;case"tool_calls":case"function_call":return E.FunctionCall;case"content_filter":return E.Error;default:return E.Stop}}l(Zt,"convertFinishReason");function Yt(){let t="",e="",n=0,s=0,r=0;const o=new Map,i=new Set;function u(a){const c=[];switch(a.type){case"response.created":{t=a.response.id||`openai-${Date.now()}`,e=a.response.model,c.push({type:"start",id:t,data:{model:e,timestamp:Date.now()}});break}case"response.output_text.delta":{c.push({type:"text",data:{text:a.delta,index:n}});break}case"response.function_call_arguments.delta":{const f=a.item_id;o.has(f)||(s++,o.set(f,{id:f,name:"",argumentsBuffer:""}),c.push({type:"tool-call-start",data:{index:s,id:f,name:""}}));const d=o.get(f);d.argumentsBuffer+=a.delta;break}case"response.function_call_arguments.done":{const f=a.item_id;if(o.get(f)){try{const p=JSON.parse(a.arguments);c.push({type:"tool-call-complete",data:{index:s,id:f,name:a.name,arguments:p}})}catch(p){throw new Error(`Failed to parse function call arguments for ${a.name}: ${p instanceof Error?p.message:String(p)}`)}o.delete(f)}break}case"response.completed":{const f=a.response.usage;c.push({type:"complete",data:{finishReason:a.response.incomplete_details?E.Error:E.Stop,usage:{in:f?.input_tokens||0,out:f?.output_tokens||0}}});break}case"response.failed":{c.push({type:"error",data:{type:"RESPONSES_API_ERROR",message:`Response failed: ${a.response.status}`,raw:a}});break}case"response.output_item.added":{if(a.item?.type==="reasoning"){const f=a.item.id;i.add(f),r++,c.push({type:"thinking-start",data:{index:r}})}break}case"response.reasoning_text.delta":{a.delta&&c.push({type:"thinking-delta",data:{index:r,text:a.delta}});break}case"response.reasoning_summary_text.delta":{a.delta&&c.push({type:"thinking-delta",data:{index:r,text:a.delta}});break}case"response.output_item.done":{if(a.item?.type==="reasoning"){const f=a.item.id;i.delete(f)}break}}return c}return l(u,"handleEvent"),{handleEvent:u}}l(Yt,"createResponsesAPIStreamingAdapter");const m={GPT_5:"gpt-5",GPT_5_MINI:"gpt-5-mini",GPT_5_NANO:"gpt-5-nano",GPT_5_CHAT_LATEST:"gpt-5-chat-latest",GPT_5_PRO:"gpt-5-pro",GPT_5_CODEX:"gpt-5-codex",GPT_4_5_PREVIEW:"gpt-4.5-preview",GPT_4_5_PREVIEW_2025_02_27:"gpt-4.5-preview-2025-02-27",GPT_4_1:"gpt-4.1",GPT_4_1_2025_04_14:"gpt-4.1-2025-04-14",GPT_4_1_MINI:"gpt-4.1-mini",GPT_4_1_MINI_2025_04_14:"gpt-4.1-mini-2025-04-14",GPT_4_1_NANO:"gpt-4.1-nano",GPT_4_1_NANO_2025_04_14:"gpt-4.1-nano-2025-04-14",GPT_4O:"gpt-4o",GPT_4O_2024_05_13:"gpt-4o-2024-05-13",GPT_4O_2024_08_06:"gpt-4o-2024-08-06",GPT_4O_2024_11_20:"gpt-4o-2024-11-20",GPT_4O_MINI:"gpt-4o-mini",GPT_4O_MINI_2024_07_18:"gpt-4o-mini-2024-07-18",GPT_4O_AUDIO_PREVIEW:"gpt-4o-audio-preview",GPT_4O_AUDIO_PREVIEW_2024_10_01:"gpt-4o-audio-preview-2024-10-01",GPT_4O_AUDIO_PREVIEW_2024_12_17:"gpt-4o-audio-preview-2024-12-17",GPT_4O_AUDIO_PREVIEW_2025_06_03:"gpt-4o-audio-preview-2025-06-03",GPT_4O_MINI_AUDIO_PREVIEW:"gpt-4o-mini-audio-preview",GPT_4O_MINI_AUDIO_PREVIEW_2024_12_17:"gpt-4o-mini-audio-preview-2024-12-17",GPT_REALTIME:"gpt-realtime",GPT_REALTIME_MINI:"gpt-realtime-mini",GPT_4O_REALTIME_PREVIEW:"gpt-4o-realtime-preview",GPT_4O_REALTIME_PREVIEW_2024_10_01:"gpt-4o-realtime-preview-2024-10-01",GPT_4O_REALTIME_PREVIEW_2024_12_17:"gpt-4o-realtime-preview-2024-12-17",GPT_4O_REALTIME_PREVIEW_2025_06_03:"gpt-4o-realtime-preview-2025-06-03",GPT_4O_MINI_REALTIME_PREVIEW:"gpt-4o-mini-realtime-preview",GPT_4O_MINI_REALTIME_PREVIEW_2024_12_17:"gpt-4o-mini-realtime-preview-2024-12-17",GPT_4O_SEARCH_PREVIEW:"gpt-4o-search-preview",GPT_4O_SEARCH_PREVIEW_2025_03_11:"gpt-4o-search-preview-2025-03-11",GPT_4O_MINI_SEARCH_PREVIEW:"gpt-4o-mini-search-preview",GPT_4O_MINI_SEARCH_PREVIEW_2025_03_11:"gpt-4o-mini-search-preview-2025-03-11",GPT_4O_TRANSCRIBE:"gpt-4o-transcribe",GPT_4O_MINI_TRANSCRIBE:"gpt-4o-mini-transcribe",GPT_4O_MINI_TTS:"gpt-4o-mini-tts",GPT_IMAGE_1:"gpt-image-1",GPT_IMAGE_1_MINI:"gpt-image-1-mini",O4_MINI:"o4-mini",O4_MINI_2025_04_16:"o4-mini-2025-04-16",O3:"o3",O3_PRO:"o3-pro",O3_MINI:"o3-mini",O3_MINI_2025_01_31:"o3-mini-2025-01-31",O1_PRO:"o1-pro",O1_PRO_2025_03_19:"o1-pro-2025-03-19",O1:"o1",O1_2024_12_17:"o1-2024-12-17",O1_MINI:"o1-mini",O1_MINI_2024_09_12:"o1-mini-2024-09-12",O1_PREVIEW:"o1-preview",O1_PREVIEW_2024_09_12:"o1-preview-2024-09-12",GPT_OSS_120B:"gpt-oss-120b",GPT_OSS_7B:"gpt-oss-7b",SORA_2:"sora-2",SORA_2025_05_02:"sora-2025-05-02",CODEX_MINI:"codex-mini",COMPUTER_USE_PREVIEW:"computer-use-preview"},Re=[m.GPT_5,m.GPT_5_MINI,m.GPT_5_NANO,m.GPT_5_CHAT_LATEST,m.GPT_5_PRO,m.GPT_5_CODEX,m.GPT_4_1,m.GPT_4_1_2025_04_14,m.GPT_4_1_MINI,m.GPT_4_1_MINI_2025_04_14,m.GPT_4_1_NANO,m.GPT_4_1_NANO_2025_04_14,m.GPT_4O,m.GPT_4O_2024_05_13,m.GPT_4O_2024_08_06,m.GPT_4O_2024_11_20,m.GPT_4O_MINI,m.GPT_4O_MINI_2024_07_18,m.GPT_4O_AUDIO_PREVIEW,m.GPT_4O_AUDIO_PREVIEW_2024_10_01,m.GPT_4O_AUDIO_PREVIEW_2024_12_17,m.GPT_4O_AUDIO_PREVIEW_2025_06_03,m.GPT_4O_MINI_AUDIO_PREVIEW,m.GPT_4O_MINI_AUDIO_PREVIEW_2024_12_17,m.GPT_REALTIME,m.GPT_REALTIME_MINI,m.GPT_4O_REALTIME_PREVIEW,m.GPT_4O_REALTIME_PREVIEW_2024_10_01,m.GPT_4O_REALTIME_PREVIEW_2024_12_17,m.GPT_4O_REALTIME_PREVIEW_2025_06_03,m.GPT_4O_MINI_REALTIME_PREVIEW,m.GPT_4O_MINI_REALTIME_PREVIEW_2024_12_17,m.GPT_4O_SEARCH_PREVIEW,m.GPT_4O_SEARCH_PREVIEW_2025_03_11,m.GPT_4O_MINI_SEARCH_PREVIEW,m.GPT_4O_MINI_SEARCH_PREVIEW_2025_03_11,m.GPT_4O_TRANSCRIBE,m.GPT_4O_MINI_TRANSCRIBE,m.O4_MINI,m.O4_MINI_2025_04_16,m.O3,m.O3_PRO,m.O3_MINI,m.O3_MINI_2025_01_31],Pe=m.GPT_5;function Oe(t){if(t&&t.length>0)return t.map(e=>{const n=W.toJSONSchema(e.schema);return{type:"function",strict:!0,name:e.name,description:e.description,parameters:n}})}l(Oe,"prepareTools");function ve(t){return t.map(Qt).flat(1)}l(ve,"convertAxleMessageToResponseInput");function Qt(t){switch(t.role){case"tool":return Vt(t);case"assistant":return en(t);default:return tn(t)}}l(Qt,"convertMessage");function Vt(t){return t.content.map(e=>({type:"function_call_output",call_id:e.id,output:e.content}))}l(Vt,"convertToolMessage");function en(t){const e=[],n=t.content.filter(i=>i.type==="thinking");if(n.length>0)for(const i of n)e.push({type:"reasoning",id:`reasoning_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,summary:[{type:"summary_text",text:i.text}]});const s=C(t.content),r=t.content.filter(i=>i.type==="tool-call"),o=r.length>0?r.map(i=>({type:"function",id:i.id,function:{name:i.name,arguments:JSON.stringify(i.parameters)}})):void 0;return(s||o)&&e.push({role:t.role,content:s,...o&&{toolCalls:o}}),e}l(en,"convertAssistantMessage");function tn(t){if(typeof t.content=="string")return{role:t.role,content:t.content};{const e=t.content.map(nn).filter(n=>n!==null);return{role:t.role,content:e}}}l(tn,"convertUserMessage");function nn(t){if(t.type==="text")return{type:"input_text",text:t.text};if(t.type==="file"){if(t.file.type==="image")return{type:"input_image",image_url:`data:${t.file.mimeType};base64,${t.file.base64}`,detail:"auto"};if(t.file.type==="document")return{type:"input_file",filename:t.file.path,file_data:`data:${t.file.mimeType};base64,${t.file.base64}`}}return t.type==="thinking",null}l(nn,"convertContentPart");async function*sn(t){const{client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}=t,{recorder:a}=i;Re.includes(n)?yield*on({client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}):yield*rn({client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u})}l(sn,"createStreamingRequest");async function*rn(t){const{client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}=t,{recorder:a}=i,c=ke(o),f={model:n,messages:be(s,r),...c&&{tools:c},...u,stream:!0};a?.debug?.log(f);const d=Xt();try{const p=await e.chat.completions.create(f);for await(const _ of p){const h=d.handleChunk(_);for(const g of h)yield g}}catch(p){a?.error?.log(p),yield{type:"error",data:{type:"STREAMING_ERROR",message:p instanceof Error?p.message:String(p),raw:p}}}}l(rn,"createChatCompletionStream");async function*on(t){const{client:e,model:n,messages:s,system:r,tools:o,runtime:i,options:u}=t,{recorder:a}=i;console.log(u);const c=Oe(o),f={model:n,input:ve(s),...r&&{instructions:r},stream:!0,...c?{tools:c}:{},...u};a?.debug?.log(f);const d=Yt();try{const p=e.responses.stream(f);for await(const _ of p){const h=d.handleEvent(_);for(const g of h)yield g}}catch(p){a?.error?.log(p),yield{type:"error",data:{type:"STREAMING_ERROR",message:p instanceof Error?p.message:String(p),raw:p}}}}l(on,"createResponsesAPIStream");async function an(t){const{client:e,model:n,messages:s,system:r,tools:o,context:i,options:u}=t,{recorder:a}=i,c=Oe(o),f={model:n,input:ve(s),...r&&{instructions:r},...c?{tools:c}:{},...u};a?.debug?.log(f);let d;try{const p=await e.responses.create(f);d=cn(p)}catch(p){a?.error?.log(p),d=B(p)}return a?.debug?.log(d),d}l(an,"createGenerationRequestWithResponsesAPI");function cn(t){if(t.error)return{type:"error",error:{type:t.error.code||"undetermined",message:t.error.message||"Response generation failed"},usage:{in:t.usage?.input_tokens??0,out:t.usage?.output_tokens??0},raw:t};const e=t.output?.filter(r=>r.type==="reasoning")?.map(r=>r),n=[];if(e&&e.length>0)for(const r of e){const o=r.summary?.[0]?.text||r.content?.[0]?.text||"";(o||r.encrypted_content)&&n.push({type:"thinking",text:o,...r.encrypted_content&&{encrypted:r.encrypted_content}})}t.output_text&&n.push({type:"text",text:t.output_text});const s=t.output?.filter(r=>r.type==="function_call");if(s&&s.length>0)for(const r of s){const o=r;try{n.push({type:"tool-call",id:o.id||"",name:o.name||"",parameters:o.arguments?JSON.parse(o.arguments):{}})}catch(i){throw new Error(`Failed to parse tool call arguments for ${o.name}: ${i instanceof Error?i.message:String(i)}`)}}return{type:"success",id:t.id,model:t.model||"",role:"assistant",finishReason:t.incomplete_details?E.Error:E.Stop,content:n,text:C(n)??"",usage:{in:t.usage?.input_tokens??0,out:t.usage?.output_tokens??0},raw:t}}l(cn,"fromModelResponse");const Ne="OpenAI";class un{static{l(this,"OpenAIProvider")}name=Ne;client;model;constructor(e,n){this.model=n||Pe,this.client=new tt({apiKey:e})}async createGenerationRequest(e){return Re.includes(this.model)?await an({client:this.client,model:this.model,...e}):await Kt({client:this.client,model:this.model,...e})}createStreamingRequest(e){const{messages:n,system:s,tools:r,context:o,options:i}=e;return sn({client:this.client,model:this.model,messages:n,system:s,tools:r,runtime:o,options:i})}}async function $e(t){const{provider:e,messages:n,system:s,tools:r,recorder:o,options:i}=t;return e.createGenerationRequest({messages:n,system:s,tools:r,context:{recorder:o},options:i})}l($e,"generate");function ln(t,e){if(!e||Object.keys(e).length===0)throw new S(`The provider ${t} is not configured. Please check your configuration.`);switch(t){case"openai":return new un(e["api-key"],e.model);case"anthropic":return new Et(e["api-key"],e.model);case"gemini":return new Pt(e["api-key"],e.model);case"ollama":{const n=e;return new Wt(n.model,n.url)}default:throw new S("The provider is unsupported")}}l(ln,"getProvider");class ae extends S{static{l(this,"TaskError")}constructor(e,n){super(e,{code:"TASK_ERROR",id:n?.id,details:{taskType:n?.taskType,taskIndex:n?.taskIndex,...n?.details},cause:n?.cause}),Object.setPrototypeOf(this,ae.prototype)}}const I={Running:"running",Success:"success",PartialSuccess:"partialSuccess",Fail:"fail"};var x=(t=>(t[t.Trace=10]="Trace",t[t.Debug=20]="Debug",t[t.Info=30]="Info",t[t.Warn=40]="Warn",t[t.Error=50]="Error",t[t.Fatal=60]="Fatal",t))(x||{});class fn{static{l(this,"Recorder")}instanceId=crypto.randomUUID();currentLevel=x.Info;logs=[];writers=[];_debug;_info;_warn;_error;constructor(){this.buildMethods()}buildMethods(){this._debug=x.Debug>=this.currentLevel?this.createLoggingFunction(x.Debug):null,this._info=x.Info>=this.currentLevel?this.createLoggingFunction(x.Info):null,this._warn=x.Warn>=this.currentLevel?this.createLoggingFunction(x.Warn):null,this._error=this.createLoggingFunction(x.Error)}set level(e){this.currentLevel=e,this.buildMethods()}get level(){return this.currentLevel}get info(){return this._info}get warn(){return this._warn}get error(){return this._error}get debug(){return this._debug}subscribe(e){this.writers.includes(e)||this.writers.push(e)}unsubscribe(e){const n=this.writers.indexOf(e);n!==-1&&this.writers.splice(n,1)}publish(e){this.logs.push(e);for(const n of this.writers)n.handleEvent(e)}logFunction(e,n,...s){let r=s.map(o=>typeof o=="string"?{message:o}:o instanceof Error?nt(o):o);this.publish({level:e,time:Date.now(),kind:n,payload:r})}createLoggingFunction(e){return{log:this.logFunction.bind(this,e,"body"),heading:{log:this.logFunction.bind(this,e,"heading")}}}getLogs(e=x.Info){return this.logs.filter(n=>n.level>=e)}async shutdown(){for(const e of this.writers)typeof e.flush=="function"&&await e.flush()}}async function pn(t,e){const{defaults:n,tag:s}=e;let r=null,o="";if(t)try{o=te(t),r=await H(o,{encoding:"utf-8"})}catch{throw new Error(`${s} not found, see --help for details`)}else{for(const i of n.formats)try{o=te(n.name+"."+i),r=await H(o,{encoding:"utf-8"});break}catch{continue}if(r===null)throw new Error(`${s} not found, see --help for details`)}return{content:r,format:o.split(".").pop()??""}}l(pn,"searchAndLoadFile");async function dn(t,e){let n="";for(const s of t){const r=await ue(s);e?.debug?.log(`many-files parser. For glob "${s}", found ${r.length} files.`);const o=await Promise.all(r.map(async i=>{const u=await H(i,"utf-8");return i+`:
`+u}));n+=o.join(`
`)}return n}l(dn,"loadManyFiles");function _n(t,e){t=t.replace("**/*","**");const n=/(?<asterisks>\*{1,2})(?<extension>\.[^\\/]+)?/,s=t.match(n);if(s){let r="";return s.groups?.asterisks.length==1?r+=e.stem:r+=e.dir+e.stem,s.groups?.extension?r+=s.groups.extension:r+=e.ext,t.replace(s[0],r)}return t}l(_n,"replaceFilePattern");function mn(t){const e=/(?<name>[^\\/]+)(?<extension>\.[^\\/]+)$/,n=t.match(e);return n&&n.length>0&&n.groups?{abs:t,dir:t.replace(n[0],""),ext:n.groups.extension,stem:n.groups.name,name:n[0]}:null}l(mn,"pathToComponents");async function Me(t){const e=ut(t);try{await le(e)}catch{await ct(e),await Me(e)}}l(Me,"ensureDirectoryExistence");async function gn({filePath:t,content:e}){await Me(t),await at(t,e)}l(gn,"writeFileWithDirectories");const J=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".tiff"],j=[".pdf"],K=[".txt",".md",".markdown"],Ge=20*1024*1024;function hn(t){return t.type==="text"}l(hn,"isTextFileInfo");function yn(t){return t.type==="image"||t.type==="document"}l(yn,"isBase64FileInfo");function En(t){const e=fe(t).toLowerCase();if(K.includes(e))return"utf-8";if(J.includes(e)||j.includes(e))return"base64";{const n=[...K,...J,...j];throw new Error(`Unsupported file type: ${e}. Supported types: ${n.join(", ")}`)}}l(En,"getEncodingForFile");async function z(t,e){const n=te(t);try{await le(n)}catch{throw new Error(`File not found: ${t}`)}const s=await it(n);if(s.size>Ge)throw new Error(`File too large: ${s.size} bytes. Maximum allowed: ${Ge} bytes`);const r=fe(n).toLowerCase(),o=n.split("/").pop()||"";if((e||En(n))==="utf-8"){if(!K.includes(r))throw new Error(`Unsupported text file type: ${r}. Supported types: ${K.join(", ")}`);let u;switch(r){case".txt":u="text/plain";break;case".md":case".markdown":u="text/markdown";break;default:u="text/plain"}const a=await H(n,"utf-8");return{path:n,content:a,mimeType:u,size:s.size,name:o,type:"text"}}else{let u,a;if(J.includes(r))switch(u="image",r){case".jpg":case".jpeg":a="image/jpeg";break;case".png":a="image/png";break;case".gif":a="image/gif";break;case".webp":a="image/webp";break;case".bmp":a="image/bmp";break;case".tiff":a="image/tiff";break;default:a="image/jpeg"}else if(j.includes(r))u="document",a="application/pdf";else throw new Error(`Unsupported file type: ${r}. Supported types: ${[...J,...j].join(", ")}`);const f=(await H(n)).toString("base64");return{path:n,base64:f,mimeType:a,size:s.size,name:o,type:u}}}l(z,"loadFileContent");function In(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):wn(t.using,e)?!t.jobs||typeof t.jobs!="object"?(e&&(e.value="Missing or invalid 'jobs' property"),!1):Ce(t.jobs,e)?!0:(e&&(e.value=`Invalid 'jobs' property: ${e?.value}`),!1):(e&&(e.value=`Invalid 'using' property: ${e?.value}`),!1)}l(In,"isJobConfig");function wn(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(typeof t.engine!="string")return e&&(e.value="Missing or invalid 'engine' property"),!1;if(!["openai","anthropic","ollama","gemini"].includes(t.engine))return e&&(e.value="Invalid provider type. Must be 'openai', 'anthropic', 'gemini', or 'ollama'"),!1;switch(t.engine){case"ollama":if("model"in t&&typeof t.model!="string")return e&&(e.value="Property 'model' must be a string"),!1;if("url"in t&&typeof t.url!="string")return e&&(e.value="Property 'url' must be a string"),!1;break;case"gemini":case"anthropic":case"openai":if("api-key"in t&&typeof t["api-key"]!="string")return e&&(e.value="Property 'api-key' must be a string"),!1;if("model"in t&&typeof t.model!="string")return e&&(e.value="Property 'model' must be a string"),!1;break}return!0}l(wn,"isUsing");function Ce(t,e){for(const[n,s]of Object.entries(t))if(!Tn(s,e))return e&&(e.value=`Invalid job '${n}': ${e?.value}`),!1;return!0}l(Ce,"isDAGJob");function Tn(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(!xn(t,e))return!1;if("dependsOn"in t&&t.dependsOn!==void 0){const n=t.dependsOn;if(typeof n!="string")if(Array.isArray(n)){for(let s=0;s<n.length;s++)if(typeof n[s]!="string")return e&&(e.value=`Dependency at index ${s} must be a string`),!1}else return e&&(e.value="Property 'dependsOn' must be a string or array of strings"),!1}return!0}l(Tn,"isDAGJobValue");function xn(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):"batch"in t?Sn(t,e):An(t,e)}l(xn,"isJob");function An(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if("batch"in t)return e&&(e.value="Serial job should not have a batch property"),!1;if(t.tools!==void 0){if(!Array.isArray(t.tools))return e&&(e.value="Property 'tools' must be an array"),!1;for(const n of t.tools)if(typeof n!="string")return e&&(e.value="All tools must be strings"),!1}if(!Array.isArray(t.steps))return e&&(e.value="Property 'steps' must be an array"),!1;for(let n=0;n<t.steps.length;n++)if(!Le(t.steps[n],e))return e&&(e.value=`Invalid step at index ${n}: ${e?.value}`),!1;return!0}l(An,"isSerialJob");function Sn(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(t.tools!==void 0){if(!Array.isArray(t.tools))return e&&(e.value="Property 'tools' must be an array"),!1;for(const n of t.tools)if(typeof n!="string")return e&&(e.value="All tools must be strings"),!1}if(!Array.isArray(t.batch))return e&&(e.value="Property 'batch' must be an array"),!1;for(let n=0;n<t.batch.length;n++)if(!kn(t.batch[n],e))return e&&(e.value=`Invalid batch item at index ${n}: ${e?.value}`),!1;if(!Array.isArray(t.steps))return e&&(e.value="Property 'steps' must be an array"),!1;for(let n=0;n<t.steps.length;n++)if(!Le(t.steps[n],e))return e&&(e.value=`Invalid step at index ${n}: ${e?.value}`),!1;return!0}l(Sn,"isBatchJob");function kn(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(t.type!=="files")return e&&(e.value="Property 'type' must be 'files'"),!1;if(typeof t.source!="string")return e&&(e.value="Property 'source' must be a string"),!1;if(typeof t.bind!="string")return e&&(e.value="Property 'bind' must be a string"),!1;if(t["skip-if"]!==void 0){if(!Array.isArray(t["skip-if"]))return e&&(e.value="Property 'skip-if' must be an array"),!1;for(let n=0;n<t["skip-if"].length;n++)if(!bn(t["skip-if"][n],e))return e&&(e.value=`Invalid skip condition at index ${n}: ${e?.value}`),!1}return!0}l(kn,"isBatchOptions");function bn(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):t.type!=="file-exist"?(e&&(e.value="Property 'type' must be 'file-exist'"),!1):typeof t.pattern!="string"?(e&&(e.value="Property 'pattern' must be a string"),!1):!0}l(bn,"isSkipOptions");function Le(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):!t.uses||typeof t.uses!="string"?(e&&(e.value="Step must have a string 'uses' property"),!1):t.uses==="chat"?Rn(t,e):t.uses==="write-to-disk"?Pn(t,e):(e&&(e.value=`Unknown uses type: ${t.uses}`),!1)}l(Le,"isStep");function Rn(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(t.uses!=="chat")return e&&(e.value="Uses must be 'chat'"),!1;if(typeof t.message!="string")return e&&(e.value="Property 'message' must be a string"),!1;if(t.output!==void 0){if(!t.output||typeof t.output!="object"||Array.isArray(t.output))return e&&(e.value="Property 'output' must be an object"),!1;const n=["string","string[]","number","boolean"];for(const[s,r]of Object.entries(t.output))if(typeof s!="string"||typeof r!="string"||!n.includes(r))return e&&(e.value="Property 'output' must be a Record<string, ResTypeStrings> where ResTypeStrings is 'string' | 'string[]' | 'number' | 'boolean'"),!1}if(t.system!==void 0&&typeof t.system!="string")return e&&(e.value="Property 'system' must be a string"),!1;if(t.replace!==void 0){if(!Array.isArray(t.replace))return e&&(e.value="Property 'replace' must be an array"),!1;for(let n=0;n<t.replace.length;n++)if(!On(t.replace[n],e))return e&&(e.value=`Invalid replace at index ${n}: ${e?.value}`),!1}if(t.tools!==void 0){if(!Array.isArray(t.tools))return e&&(e.value="Property 'tools' must be an array"),!1;for(const n of t.tools)if(typeof n!="string")return e&&(e.value="All tools must be strings"),!1}if(t.images!==void 0){if(!Array.isArray(t.images))return e&&(e.value="Property 'images' must be an array"),!1;for(let n=0;n<t.images.length;n++)if(!vn(t.images[n],e))return e&&(e.value=`Invalid image at index ${n}: ${e?.value}`),!1}if(t.documents!==void 0){if(!Array.isArray(t.documents))return e&&(e.value="Property 'documents' must be an array"),!1;for(let n=0;n<t.documents.length;n++)if(!Nn(t.documents[n],e))return e&&(e.value=`Invalid document at index ${n}: ${e?.value}`),!1}if(t.references!==void 0){if(!Array.isArray(t.references))return e&&(e.value="Property 'references' must be an array"),!1;for(let n=0;n<t.references.length;n++)if(!$n(t.references[n],e))return e&&(e.value=`Invalid reference at index ${n}: ${e?.value}`),!1}return!0}l(Rn,"isChatStep");function Pn(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(t.uses!=="write-to-disk")return e&&(e.value="Uses must be 'write-to-disk'"),!1;if(typeof t.output!="string")return e&&(e.value="Property 'output' must be a string"),!1;if(t.keys!==void 0&&typeof t.keys!="string")if(Array.isArray(t.keys)){for(let n=0;n<t.keys.length;n++)if(typeof t.keys[n]!="string")return e&&(e.value=`Key at index ${n} must be a string`),!1}else return e&&(e.value="Property 'keys' must be a string or array of strings"),!1;return!0}l(Pn,"isWriteToDiskStep");function On(t,e){if(!t||typeof t!="object")return e&&(e.value="Not an object"),!1;if(typeof t.pattern!="string")return e&&(e.value="Property 'pattern' must be a string"),!1;if(t.source!=="file")return e&&(e.value="Property 'source' must be 'file'"),!1;if(typeof t.files!="string"&&!Array.isArray(t.files))return e&&(e.value="Property 'files' must be a string or an array of strings"),!1;if(Array.isArray(t.files)){for(let n=0;n<t.files.length;n++)if(typeof t.files[n]!="string")return e&&(e.value=`Files entry at index ${n} must be a string`),!1}return!0}l(On,"isReplace");function vn(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):typeof t.file!="string"?(e&&(e.value="Property 'file' must be a string"),!1):!0}l(vn,"isImageReference");function Nn(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):typeof t.file!="string"?(e&&(e.value="Property 'file' must be a string"),!1):!0}l(Nn,"isDocumentReference");function $n(t,e){return!t||typeof t!="object"?(e&&(e.value="Not an object"),!1):typeof t.file!="string"?(e&&(e.value="Property 'file' must be a string"),!1):!0}l($n,"isTextFileReference");class Mn{static{l(this,"FileRunPlanner")}constructor(e,n,s=[]){this.source=e,this.bind=n,this.skipConditions=s}async plan(e){const n=[],s=await ue(this.source,{withFileTypes:!0});for(const r of s){const o=r.fullpath(),i=mn(o);let u=!1;for(const a of this.skipConditions)if(u=await a.eval({components:i}),u)break;if(!u){const a=await st(o,"utf-8"),c={variables:{[this.bind]:a,...i},tasks:e};n.push(c)}}return n}}class Gn{static{l(this,"MultiPlanner")}planners;constructor(e){this.planners=e}async plan(e){const n=this.planners.map(async r=>await r.plan(e));return(await Promise.all(n)).flat()}}function se(t,e,n="{{}}"){const s=n==="{{}}"?/\{\{(.*?)\}\}/g:/\{(.*?)\}/g;return t=t.replace(s,(r,o)=>{if(o=o.trim(),Object.prototype.hasOwnProperty.call(e,o)){const i=e[o];return i==null?"":String(i)}return r}),t}l(se,"replaceVariables");class Cn{static{l(this,"FileExistSkipCondition")}constructor(e){this.pattern=e}type="file-exist";async eval(e){const n=se(this.pattern,e.components,"{}");try{return await rt(n,ot.F_OK),!0}catch{return!1}}}function q(t){return Array.isArray(t)?t:[t]}l(q,"arrayify");function N(t,e){return e?`${e}:${t.slice(0,8)}`:t.slice(0,8)}l(N,"friendly");function Ln(t){return new Promise(e=>setTimeout(e,t))}l(Ln,"delay");const Dn=w.object({searchTerm:w.string().describe("The search term to query")});class Fn{static{l(this,"BraveSearchTool")}name="brave";description="Perform a search using the Brave search engine";schema=Dn;apiKey;throttle;lastExecTime=0;constructor(e){e&&this.setConfig(e)}setConfig(e){const{rateLimit:n}=e;this.apiKey=e["api-key"],this.throttle=n?1100/n:void 0}async execute(e,n){const{searchTerm:s}=e;if(this.throttle){for(;Date.now()-this.lastExecTime<this.throttle;)await Ln(this.throttle-(Date.now()-this.lastExecTime));this.lastExecTime=Date.now()}try{const r=this.apiKey,o="https://api.search.brave.com/res/v1/web/search",i=new URL(o);i.searchParams.append("q",s),i.searchParams.append("format","json");const u=await fetch(i.toString(),{method:"GET",headers:{Accept:"application/json","X-Subscription-Token":r}});if(!u.ok)throw new Error(`[Brave] HTTP error ${u.status}: ${u.statusText}`);const a=await u.json();return JSON.stringify(a)}catch(r){throw r instanceof Error?new Error(`[Brave] Error fetching search results: ${r.message}`):r}}}const De=new Fn,Un=G.object({operation:G.enum(["add","subtract","multiply","divide"]).describe("The operation to perform (add, subtract, multiply, divide)"),a:G.number().describe("First operand"),b:G.number().describe("Second operand")}),Fe={name:"calculator",description:"Performs basic arithmetic operations",schema:Un,execute:l(async({operation:t,a:e,b:n},s)=>{switch(t){case"add":return`${e} + ${n} = ${e+n}`;case"subtract":return`${e} - ${n} = ${e-n}`;case"multiply":return`${e} * ${n} = ${e*n}`;case"divide":if(n===0)throw new Error("Cannot divide by zero");return`${e} / ${n} = ${e/n}`;default:throw new Error(`Unknown operation: ${t}`)}},"execute")},Wn=w.object({output:w.string().describe("The file path to write to"),keys:w.array(w.string()).default(["response"]).describe("Variable names to write to the file")}),Ue={name:"write-to-disk",description:"Write variables to a file on disk",schema:Wn,async execute(t,e){const{output:n,keys:s}=t,{variables:r,options:o,recorder:i}=e;if(o?.warnUnused){const c=s.filter(f=>!(f in r));c.length>0&&i?.warn?.log(`[Write To Disk] The following keys were not found in the variables: ${c.join(", ")}`)}let u="";if(s.length===1?u=r[s[0]]??"<not found>":u=s.map(c=>`[${c}]:
${r[c]??"<not found>"}
`).join(`
`),o?.dryRun){i?.info?.log("[Dry run] Write to Disk is not executed.");return}let a="";n.includes("*")?a=_n(n,r.file):a=se(n,r,"{}"),await gn({filePath:a,content:u})}};class We{static{l(this,"ExecutableRegistry")}executables=new Map;register(e){if(this.executables.has(e.name))throw new Error(`Executable with name '${e.name}' is already registered`);this.executables.set(e.name,e)}get(e){const n=this.executables.get(e);if(!n)throw new Error(`Executable '${e}' is not registered`);return n}has(e){return this.executables.has(e)}getAll(){return Array.from(this.executables.values())}}function Hn(){const t=new We;return t.register(Ue),t.register(De),t.register(Fe),t}l(Hn,"createExecutableRegistry");function X(t,e=0){const n={};for(const[s,r]of Object.entries(t))if(typeof r=="string")switch(r){case"string":n[s]=e===0?w.string():w.string().optional();break;case"number":n[s]=e===0?w.number():w.number().optional();break;case"boolean":n[s]=e===0?w.boolean():w.boolean().optional();break;case"string[]":n[s]=w.array(w.string());break;default:throw new Error(`Unsupported declarative type: ${r}`)}else if(Array.isArray(r))if(r.length===1&&typeof r[0]=="object"){const o=X(r[0],e+1);n[s]=w.array(w.object(o))}else throw new Error(`Unsupported array format for key ${s}. Expected [DeclarativeSchema].`);else n[s]=w.object(X(r,e+1));return n}l(X,"declarativeToOutputSchema");function Z(t){if(t instanceof w.ZodString)return["string","Your answer"];if(t instanceof w.ZodNumber)return["number",42];if(t instanceof w.ZodBoolean)return["boolean",!0];if(t instanceof w.ZodArray){const e=t.element;if(e instanceof w.ZodString)return["string array",["answer 1","answer 2","third answer"]];if(e instanceof w.ZodNumber)return["number array",[42,59,3.14]];if(e instanceof w.ZodBoolean)return["boolean array",[!0,!1,!1]];if(e instanceof w.ZodObject){const[n,s]=Z(e);return["object array",[s,s]]}return["array",[]]}if(t instanceof w.ZodObject){const e=t.shape,n={};for(const[s,r]of Object.entries(e)){const[o,i]=Z(r);n[s]=i}return["JSON object",n]}if(t instanceof w.ZodOptional){const e=t.unwrap(),[n,s]=Z(e);return[`${n} | undefined`,s]}}l(Z,"zodToExample");function He(t){return typeof t=="object"&&Object.values(t).every(e=>e&&typeof e=="object"&&"_def"in e)}l(He,"isOutputSchema");class Be{static{l(this,"AbstractInstruct")}type="instruct";prompt;system=null;inputs={};tools={};files=[];textReferences=[];instructions=[];schema;rawResponse;_taggedSections=void 0;_result=void 0;constructor(e,n){this.prompt=e,this.schema=n}setInputs(e){this.inputs=e}addInput(e,n){this.inputs[e]=n}addTools(e){for(const n of e)this.tools[n.name]=n}addTool(e){this.tools[e.name]=e}addImage(e){if(e.type!=="image")throw new Error(`Expected image file, got ${e.type}`);const n=e;this.files.push(n)}addDocument(e){if(e.type!=="document")throw new Error(`Expected document file, got ${e.type}`);const n=e;this.files.push(n)}addFile(e){if(!yn(e))throw new Error(`Expected image or document file, got ${e.type}`);this.files.push(e)}addReference(e,n){if(typeof e=="string"){this.textReferences.push({content:e,name:n?.name});return}if(hn(e))this.textReferences.push({content:e.content,name:n?.name??e.name});else throw new Error(`Expected text file, got ${e.type}`)}addInstructions(e){if(typeof e!="string"||e.trim()==="")throw new Error("Instruction must be a non-empty string");this.instructions.push(e)}hasTools(){return Object.keys(this.tools).length>0}hasFiles(){return this.files.length>0}get result(){return this._result}getOutputs(){return this._result?this._result:{}}compile(e,n={}){const s=this.createUserMessage(e,n),r=this.createInstructions();return{message:s,instructions:r}}createUserMessage(e,n={}){const{recorder:s,options:r}=n,o={...e,...this.inputs};let i=se(this.prompt,o);if(this.textReferences.length>0)for(const[u,a]of this.textReferences.entries()){const c=a.name?`: ${a.name}`:"";i+=`

## Reference ${u+1}${c}

\`\`\`${a.content}'''`}if(r?.warnUnused){const u=i.match(/\{\{(.*?)\}\}/g);if(u)throw s?.error.log(`Warning unused variables ${u.join(", ")}`),new Error(`Unused variables: ${u.join(", ")}`)}return i}createInstructions(e=""){if(e=`# Instructions

`+e,Object.keys(this.schema).length>0){e+=`## Output Format Instructions
`,e+=`
Here is how you should format your output. Follow the instructions strictly.
`;for(const[s,r]of Object.entries(this.schema)){const o=this.generateFieldInstructions(s,r);e+=o}}if(this.instructions.length>0){e+=`
## Additional Instructions

`;for(const s of this.instructions)e+=`- ${s}
`}return e}generateFieldInstructions(e,n){const[s,r]=Z(n);return`
- Use <${e}></${e}> tags to indicate the answer for ${e}. The answer must be a ${s}.
  Example: <${e}>${JSON.stringify(r)}</${e}>
`}finalize(e,n={}){const{recorder:s}=n;if(this.rawResponse=e,Object.keys(this.schema).length===0){if(e.trim()==="{}"||e.trim()==="")return this._result={},this._result;throw new Error("Schema is empty, but rawValue is not an empty object representation or empty string.")}this._taggedSections=this._taggedSections||this.parseTaggedSections(e);const o={};for(const[i,u]of Object.entries(this.schema)){const a=this._taggedSections.tags[i];if(a!==void 0)o[i]=this.preprocessValue(u,a);else if(u.def.type!=="optional")throw new Error(`Expected results with tag ${i} but it does not exist`)}try{const i={};for(const[u,a]of Object.entries(this.schema))u in o&&(i[u]=a.parse(o[u]));return this._result=i,this._result}catch(i){if(i&&typeof i=="object"&&"issues"in i){const u=i.issues.map(a=>`${a.path.join(".")}: ${a.message}`).join(", ");throw new Error(`Validation failed: ${u}`)}throw i}}preprocessValue(e,n){switch(n=n.trim(),e.def.type){case"string":try{return JSON.parse(n)}catch{if(typeof n=="string")return n;throw new Error(`Cannot parse '${n}' as string. Ensure it is a valid JSON string or a plain string.`)}case"number":{const s=parseFloat(n);if(isNaN(s))throw new Error(`Cannot parse '${n}' as number`);return s}case"boolean":{const s=n.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;throw new Error(`Cannot parse '${n}' as boolean. Expected 'true' or 'false'`)}case"array":{if(n==="")return[];try{const s=JSON.parse(n);if(Array.isArray(s))return s}catch{}if(n.includes(","))return n.split(",").map(s=>{const r=s.trim();try{return JSON.parse(r)}catch{return r}}).filter(s=>s!=="")}case"object":{n.includes("```json")&&(n=n.replace(/```json/g,"").replace(/```/g,""));try{return JSON.parse(n)}catch(s){throw new Error(`Cannot parse object as JSON: ${s.message}`)}}case"optional":{const s=e.def.innerType;return this.preprocessValue(s,n)}default:return n}}parseTaggedSections(e){e.trim().startsWith("```json")&&e.trim().endsWith("```")&&(e=e.trim().slice(7,-3).trim());const n=/<(\w+)>(.*?)<\/\1>/gs,s={};let r=e;r=r.replace(n,(i,u,a)=>(s[u]=a,""));const o=/<(\w+)>(.*?)(?:<\/?\w+>|$)/gs;return r=r.replace(o,(i,u,a)=>(s[u]=a,"")),{tags:s,remaining:r.trim()}}}class D extends Be{static{l(this,"Instruct")}constructor(e,n){super(e,n)}static with(e,n){if(!n)return new D(e,{response:w.string()});if(He(n))return new D(e,n);{const s=X(n);return new D(e,s)}}}const Bn=ft(lt),qn=G.object({command:G.string().describe("The command to execute"),args:G.array(G.string()).optional().describe("Optional arguments for the command"),cwd:G.string().optional().describe("Working directory for command execution"),timeout:G.number().optional().describe("Timeout in milliseconds (default: 30000)")}),Jn={name:"exec",description:"Execute a command line command and return its output",schema:qn,execute:l(async({command:t,args:e,cwd:n,timeout:s=3e4},r)=>{const o=e?`${t} ${e.join(" ")}`:t;try{const{stdout:i,stderr:u}=await Bn(o,{cwd:n,timeout:s,maxBuffer:10485760}),a=[];return i&&a.push(`STDOUT:
${i.trim()}`),u&&a.push(`STDERR:
${u.trim()}`),a.length>0?a.join(`

`):"Command completed with no output"}catch(i){if(i instanceof Error){const u=i,a=[];throw a.push(`Error executing command: ${o}`),a.push(`Message: ${i.message}`),u.stdout&&a.push(`STDOUT:
${u.stdout.trim()}`),u.stderr&&a.push(`STDERR:
${u.stderr.trim()}`),new Error(a.join(`
`))}throw i}},"execute")};class jn{static{l(this,"ToolRegistry")}executables={};config;setConfig(e){this.config=e}register(e){if(this.executables[e.name])throw new Error(`Tool with name '${e.name}' is already registered`);this.executables[e.name]=e}get(e){const n=this.executables[e];if(!n)throw new Error(`Tool '${e}' is not registered`);return n.setConfig?.(this.config[e]),n}}let F;function qe(){return F||(F=new jn,F.register(Fe),F.register(De),F.register(Jn)),F}l(qe,"getToolRegistry");const Kn={async convert(t,e){const{recorder:n,toolNames:s}=e,{message:r,system:o,replace:i}=t;let u;t.output?u=D.with(r,t.output):u=D.with(r),o&&(u.system=o);const a=[...new Set([...s??[],...t.tools??[]])];for(const c of a){const f=qe().get(c);u.addTool(f)}if(i){for(const c of i)if(c.source==="file"){const f=q(c.files),d=await dn(f,n);u.addInput(c.pattern,d)}}if(t.images)for(const c of t.images)try{const f=await z(c.file,"base64");u.addFile(f)}catch(f){throw new Error(`Failed to load image '${c.file}': ${f.message}`)}if(t.documents)for(const c of t.documents)try{const f=await z(c.file,"base64");u.addFile(f)}catch(f){throw new Error(`Failed to load document '${c.file}': ${f.message}`)}if(t.references)for(const c of t.references)try{const f=await z(c.file,"utf-8");u.addReference(f)}catch(f){throw new Error(`Failed to load reference file '${c.file}': ${f.message}`)}return u}};class zn{static{l(this,"StepToClassRegistry")}converters=new Map;get(e){const n=this.converters.get(e);if(!n)throw new Error(`No converter registered for step: ${e}`);return n}register(e,n){this.converters.set(e,n)}}class re{static{l(this,"WriteOutputTask")}constructor(e,n=["response"]){this.output=e,this.keys=n}type="write-to-disk";_executable}const Xn={async convert(t){const e=t.keys?new re(t.output,q(t.keys)):new re(t.output);return e._executable=Ue,e}};Hn();const oe=new zn;oe.register("write-to-disk",Xn),oe.register("chat",Kn);async function Y(t,e){const{recorder:n}=e,s=t.tools??void 0,r=t.steps.map(async o=>(o.uses,await oe.get(o.uses).convert(o,{recorder:n,toolNames:s})));return Promise.all(r)}l(Y,"configToTasks");async function Je(t,e){const{batch:n}=t;return n.length===1?je(n[0]):new Gn(n.map(s=>je(s)))}l(Je,"configToPlanner");function je(t){switch(t.type){case"files":let e;return t["skip-if"]&&(e=t["skip-if"].map(s=>Zn(s))),new Mn(t.source,t.bind,e)}}l(je,"batchOptionsToPlanner");function Zn(t){switch(t.type){case"file-exist":return new Cn(t.pattern)}}l(Zn,"skipOptionsToSkipConditions");function Yn(t){return t.success===!1&&t.error!==void 0}l(Yn,"isErrorResult");function Q(t,e){return{response:t,stats:e,success:!0}}l(Q,"createResult");function V(t,e,n){return{response:e,stats:n,error:t,success:!1}}l(V,"createErrorResult");class Qn{static{l(this,"ExecutableExecutor")}async execute(e,n,s){const r=await e.execute(n,s);return{outputs:{[e.name]:r}}}}var ee=(t=>(t.LastResult="lastResult",t))(ee||{});class Vn{static{l(this,"LLMExecutor")}async execute(e,n){const{conversation:s,provider:r,stats:o,variables:i,recorder:u}=n,a=n.recorder?.options;e.system&&s.addSystem(e.system);const{message:c,instructions:f}=e.compile(i,{recorder:u,options:a}),d=e.files;if(s.addUser(pt({text:f+c,files:d})),a?.dryRun)return u?.debug?.log(s),{outputs:{}};let p=!0,_=null;for(;p;){const g=await $e({provider:r,messages:s.messages,tools:Object.values(e.tools),recorder:u});if(o.in+=g.usage.in,o.out+=g.usage.out,g.type==="error")throw new Error(JSON.stringify(g.error));if(g.type==="success")switch(g.finishReason){case E.Stop:{if(g.content){const A=g.content;s.addAssistant({id:g.id,model:g.model,content:g.content,finishReason:g.finishReason});const k=C(A);_=e.finalize(k,{recorder:u}),p=!1}break}case E.Length:throw new Error("Incomplete model output due to `max_tokens` parameter or token limit");case E.FunctionCall:{g.content&&s.addAssistant({id:g.id,model:g.model,content:g.content,finishReason:g.finishReason});const A=dt(g.content);if(A&&A.length>0){const k=await es(A,e,{variables:i,options:a,recorder:u});u?.debug?.log(k),s.addToolResults(k),p=!0}else p=!1;break}}if(g.type!=="success")throw u?.debug?.log(g),new Error("Unexpected response type")}const h=e.getOutputs();return _&&(h[ee.LastResult]=_),{outputs:h}}}async function es(t,e,n){const{recorder:s}=n,r=[];for(const o of t)r.push(new Promise((i,u)=>{const a=e.tools[o.name];if(!a){u(`Tool not found: ${o.name}`);return}s?.debug?.heading.log(`Executing tool ${a.name}`);const c=o.parameters;a.execute(c,n).then(f=>{s?.debug?.log(`Complete tool ${a.name}: ${o.id}`),i({id:o.id,name:o.name,content:JSON.stringify(f)})}).catch(u)}));return Promise.all(r)}l(es,"executeToolCalls");class Ke{static{l(this,"Conversation")}system;_messages=[];constructor(e){e&&(this._messages=e)}get messages(){return[...this._messages]}addSystem(e){this.system=e}addUser(e){typeof e=="string"?this._messages.push({role:"user",content:[{type:"text",text:e}]}):this._messages.push({role:"user",content:e})}addAssistant(e){if(typeof e=="string"){const n=e;this._messages.push({role:"assistant",id:crypto.randomUUID(),content:[{type:"text",text:n}],model:"user",finishReason:E.Custom})}else this._messages.push({role:"assistant",...e})}addToolResults(e){this._messages.push({role:"tool",content:e})}latest(){return this._messages[this._messages.length-1]}toString(){return JSON.stringify({system:this.system,messages:this._messages})}}const ie=l((t,...e)=>{const n=l(async r=>{const{recorder:o}=r;let i=[];return"steps"in t?i=await Y(t,{recorder:o}):i=[t,...e],i},"prepare");return{execute:l(async r=>{const{provider:o,variables:i,options:u,stats:a,recorder:c,name:f}=r,d=crypto.randomUUID(),p=new Vn,_=new Qn;c?.info?.log({type:"task",id:d,status:I.Running,message:`[${N(d,f)}] Starting job`});try{const h=await n({recorder:c}),g=new Ke;for(const[A,k]of h.entries()){c?.info?.log({type:"task",id:d,status:I.Running,message:`[${N(d,f)}] Processing step ${A+1}: ${k.type}`});try{let b;if(k.type==="instruct")b=await p.execute(k,{conversation:g,provider:o,stats:a,variables:i,recorder:c});else{const O=k,{type:$,_executable:P,...L}=O;b=await _.execute(P,L,{variables:i,options:u,recorder:c})}Object.assign(i,b.outputs)}catch(b){throw b instanceof S?b:new ae(`Error executing task ${k.type}`,{id:d,taskType:k.type,taskIndex:A,cause:b instanceof Error?b:new Error(String(b))})}}return c?.info?.log({type:"task",status:I.Success,id:d,message:`[${N(d,f)}] Completed ${h.length} steps`}),Q(i[ee.LastResult],a)}catch(h){const g=h instanceof S?h:new S("Serial workflow execution failed",{id:d,cause:h instanceof Error?h:new Error(String(h))});return c?.info?.log({type:"task",status:I.Fail,id:d,message:`[${N(d,f)}] Failed: ${g.message}`}),c?.error.log(g),V(g,i[ee.LastResult],a)}},"execute")}},"serialWorkflow"),ze=l((t,...e)=>{const n=l(async r=>{const{recorder:o}=r;let i=[],u=null;if("batch"in t){const a=t;u=await Je(a),i=await Y(a,{recorder:o})}else u=t,i=[...e];return[u,i]},"prepare");return{execute:l(async r=>{const{provider:o,variables:i,options:u,stats:a,recorder:c,name:f}=r,d=crypto.randomUUID();try{const[p,_]=await n({recorder:c}),h=await p.plan(_);if(c?.debug?.heading.log("Runs",h),h.length===0)return c?.info?.log("No runs to execute"),Q([],a);let g=0;c?.info?.log({type:"task",status:I.Running,id:d,message:`[${N(d,"CRW")}] Working on 0/${h.length}`});const A=l(async(P,L)=>{try{return await ie(...P.tasks).execute({provider:o,variables:{...P.variables,...i},options:u,stats:a,recorder:c,name:`${f}-${L}`})}catch(M){const ce=M instanceof S?M:new S("Error executing run",{cause:M instanceof Error?M:new Error(String(M))});return c?.error?.log(ce),V(ce,null,a)}finally{g++,c?.info?.log({type:"task",status:I.Running,id:d,message:`[${N(d,"CRW")}] Working on ${g}/${h.length}`})}},"executeRun"),k=5;let b=[];for(let P=0;P<h.length;P+=k){const L=h.slice(P,P+k),M=await Promise.all(L.map(A));b=b.concat(M)}const O=b.some(Yn);c?.info?.log({type:"task",status:O?I.PartialSuccess:I.Success,id:d,message:`[${N(d,"CRW")}] All jobs (${h.length}) completed${O?" with some errors":""}`});const $=b.map(P=>P.response);return Q($,a)}catch(p){const _=p instanceof S?p:new S("Concurrent workflow execution failed",{id:d,cause:p instanceof Error?p:new Error(String(p))});return c?.error?.log(_),V(_,null,a)}},"execute")}},"concurrentWorkflow");class ts{static{l(this,"DAGParser")}static parse(e){const n=new Map;for(const[r,o]of Object.entries(e)){const i=this.parseNodeDefinition(r,o);n.set(r,i)}return this.validateDependencies(n),this.checkForCycles(n),{stages:this.createExecutionStages(n),nodes:n}}static parseNodeDefinition(e,n){if(this.isSimpleTask(n))return{id:e,tasks:Array.isArray(n)?n:[n],dependencies:[],executionType:"serial"};if(this.isConcurrentNodeDefinition(n)){const i=n,u=i.dependsOn?q(i.dependsOn):[];return{id:e,tasks:i.tasks,dependencies:u,planner:i.planner,executionType:"concurrent"}}const s=n,r=s.dependsOn?q(s.dependsOn):[],o=q(s.task);return{id:e,tasks:o,dependencies:r,executionType:"serial"}}static isSimpleTask(e){return e.type||Array.isArray(e)}static isConcurrentNodeDefinition(e){return e&&typeof e=="object"&&"planner"in e}static validateDependencies(e){for(const n of e.values())for(const s of n.dependencies)if(!e.has(s))throw new S(`Node "${n.id}" depends on non-existent node "${s}"`)}static checkForCycles(e){const n=new Set,s=new Set,r=l(o=>{if(s.has(o))return!0;if(n.has(o))return!1;n.add(o),s.add(o);const i=e.get(o);for(const u of i.dependencies)if(r(u))return!0;return s.delete(o),!1},"hasCycle");for(const o of e.keys())if(r(o))throw new S(`Circular dependency detected involving node "${o}"`)}static createExecutionStages(e){const n=[],s=new Set,r=new Set(e.keys());for(;r.size>0;){const o=[];for(const i of r)e.get(i).dependencies.every(c=>s.has(c))&&o.push(i);if(o.length===0)throw new S("Unable to resolve DAG dependencies - possible circular reference");n.push(o),o.forEach(i=>{s.add(i),r.delete(i)})}return n}}class ns{static{l(this,"DAGJobToDefinition")}static async convert(e,n){const{recorder:s}=n,r={};for(const[o,i]of Object.entries(e)){const{dependsOn:u,...a}=i;if("batch"in a){const c=a,f=await Je(c),d=await Y(c,{recorder:s}),p={planner:f,tasks:d,...u?{dependsOn:u}:{}};r[o]=p}else{const c=await Y(a,{recorder:s});if(u){const f={task:c,dependsOn:u};r[o]=f}else r[o]=c}}return r}}async function ss(t,e,n,s={}){const{variables:r}=n,o=e.nodes.get(t);try{let i;if(o.executionType==="concurrent"&&o.planner?i=await ze(o.planner,...o.tasks).execute({...n,variables:r,name:t}):i=await ie(...o.tasks).execute({...n,variables:r,name:t}),!i.success)throw new S(`Node "${t}" failed: ${i.error?.message}`);return i.response}catch(i){if(!s.continueOnError)throw i;return null}}l(ss,"executeNode");const rs=l((t,e={})=>{const n=l(async(r,o)=>{const{recorder:i}=o,u={value:""};return Ce(r,u)?await ns.convert(r,o):(i?.warn?.log(u),r)},"prepare");return{execute:l(async r=>{const{stats:o,recorder:i}=r,{maxConcurrency:u=3}=e,a=crypto.randomUUID();try{const c=await n(t,{recorder:i});i?.debug?.log(c);const f=ts.parse(c),d=new Map;i?.info?.log({type:"task",id:a,status:I.Running,message:`[${N(a)}] Starting workflow execution with ${f.stages.length} stages`});for(const[_,h]of f.stages.entries()){i?.info?.log({type:"task",id:a,status:I.Running,message:`[${N(a)}] Stage ${_+1}/${f.stages.length}, executing ${h.length} nodes: ${h.join(", ")}`});const g=Math.min(h.length,u);for(let A=0;A<h.length;A+=g){const k=h.slice(A,A+g);(await Promise.all(k.map(async O=>{const $=await ss(O,f,r,e);return{nodeId:O,result:$}}))).forEach(({nodeId:O,result:$})=>{d.set(O,$)})}}i?.info?.log({type:"task",status:I.Success,id:a,message:`[${N(a)}] Workflow execution completed successfully`});const p=Object.fromEntries(d);return Q(p,o)}catch(c){const f=c instanceof S?c:new S("DAG workflow execution failed",{id:a,cause:c instanceof Error?c:new Error(String(c))});return i?.info?.log({type:"task",status:I.Fail,id:a,message:`[${N(a)}] Workflow execution failed: ${f.message}`}),i?.error?.log(f),V(f,null,o)}},"execute")}},"dagWorkflow"),os=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],U={success:"\u2713",fail:"\u2717",spinning:os};class is{static{l(this,"ConsoleWriter")}tasks=new Map;entries=[];truncate=0;intervalId=null;spinnerInterval=80;lastRender="";isRendering=!1;inline=!0;constructor(e={}){this.truncate=e.truncate??0,this.inline=e.inline??!0}startSpinner(){this.intervalId===null&&(this.intervalId=setInterval(()=>{[...this.tasks.values()].some(n=>n.status===I.Running)&&this.renderTasks()},this.spinnerInterval))}stopSpinner(){this.intervalId!==null&&(clearInterval(this.intervalId),this.intervalId=null)}renderTasks(){if(this.isRendering)return;if(this.isRendering=!0,this.inline&&this.lastRender){const o=this.lastRender.split(`
`).length;pe.moveCursor(process.stdout,0,-o+1),pe.clearScreenDown(process.stdout)}const e=[...this.tasks.values()],n=e.filter(o=>o.status===I.Running),s=e.filter(o=>o.status===I.Success||o.status===I.Fail);if(n.length===0&&s.length>0){let o="";for(const i of s){if(i.status===I.Success){const u=T.green(U.success);o+=`${u} ${i.text}
`}else if(i.status===I.Fail){const u=T.red(U.fail);o+=`${u} ${i.text}
`}this.tasks.delete(i.id)}console.log(o)}for(const o of this.entries){const{level:i,time:u,kind:a,payload:c}=o;a==="heading"?cs(i,c,{truncate:this.truncate}):us(i,c,{truncate:this.truncate})}this.entries=[];let r="";for(const o of this.tasks.values())if(o.status===I.Running){const i=T.cyan(U.spinning[o.frameIndex]);o.frameIndex=(o.frameIndex+1)%U.spinning.length,r+=`${i} ${o.text}
`}else if(o.status===I.Success){const i=T.green(U.success);r+=`${i} ${o.text}
`}else if(o.status===I.Fail){const i=T.red(U.fail);r+=`${i} ${o.text}
`}this.lastRender=r,process.stdout.write(r),this.isRendering=!1}handleEvent(e){const{level:n,time:s,payload:r}=e;if(r.length>0&&as(r[0])){const i=r[0],{id:u,message:a,status:c}=i;if(c===I.Running)this.tasks.set(u,{id:u,text:a,status:c,frameIndex:0});else if((c===I.Success||c===I.Fail)&&this.tasks.has(u)){const f=this.tasks.get(u);f.status=c,f.text=a}}else this.entries.push(e);this.renderTasks();const o=[...this.tasks.values()].some(i=>i.status===I.Running);o&&this.intervalId===null?this.startSpinner():!o&&this.intervalId!==null&&this.stopSpinner()}destroy(){this.stopSpinner()}}function as(t){if(typeof t!="object"||t===null)return!1;const e=t;if(e.type!=="task"||typeof e.id!="string"||typeof e.message!="string")return!1;switch(e.status){case I.Running:case I.Success:case I.PartialSuccess:case I.Fail:return!0;default:return!1}}l(as,"isTask");function cs(t,e,n){let s,r;t===x.Error?(s=T.red,r=T.redBright.bold):t===x.Warn?(s=T.yellow,r=T.yellowBright.bold):t>=x.Info?(s=T.blue,r=T.whiteBright.bold):(s=T.gray,r=T.white);const{message:o,data:i}=Ye(e);console.log(`${s("==>")} ${r(o)}`),Ze(t,i,n)}l(cs,"heading");function us(t,e,n){let s;t===x.Error?s=T.red:t===x.Warn?s=T.yellow:t>=x.Info?s=T.white:s=T.gray;const{message:r,data:o}=Ye(e);r&&console.log(s(r)),Ze(t,o,n)}l(us,"body");const Xe="    ";function Ze(t,e,n){let s;t===x.Error?(s=T.red,n.truncate=0):t==x.Warn?s=T.yellow:t>=x.Info?s=T.white:s=T.gray,e.forEach(r=>{if(typeof r=="string"){console.log(s(`${Xe}${r}`));return}for(const[o,i]of Object.entries(r)){let u=JSON.stringify(i,ls(n.truncate),"	");const a=`${o}: ${u}`.split(`
`).map(c=>Xe+c).join(`
`);console.log(s(a))}})}l(Ze,"values");function Ye(t){const[e,...n]=t;let s="",r=n;if(e){let{message:o,...i}=e;s=o&&typeof o=="string"?o:"",Object.keys(i).length>0&&(r=[i,...r])}return{message:s,data:r}}l(Ye,"toMsgData");function ls(t){return t===0?null:(e,n)=>typeof n=="string"&&n.length>t?n.slice(0,t)+"<...>":n}l(ls,"truncator");export{S as A,is as C,ge as D,We as E,D as I,x as L,R as M,he as N,fn as R,re as W,we as a,y as b,Te as c,rs as d,Se as e,Ut as f,ln as g,Pe as h,m as i,Ne as j,Be as k,z as l,He as m,X as n,$e as o,ze as p,E as q,Ke as r,ie as s,pn as t,In as u,qe as v};
